buildPack: none
pipelineConfig:
  pipelines:
    pullRequest:
      agent:
        image: golang
      setup:
        steps:
        - groovy: checkout scm
      build:
        steps:
        - sh: /usr/local/go/bin/go get github.com/golang/dep
          name: go-get-dep
        - sh: make build
          name: make-linux
        - sh: make test
          name: make-test
    release:
      setup:
        steps:
        - groovy: git 'https://github.com/thefirstofthe300/kore.git'
          when: "prow"
        - groovy: checkout scm
          when: "!prow"
        - sh: git checkout master
          name: git-checkout-master
          comment: ensure we're not on a detached head
          when: "!prow"
        - sh: git config --global credential.helper store
          when: "!prow"
          name: git-config
        - sh: jx step git credentials
          when: "!prow"
          name: git-credentials
      setVersion:
        steps:
        - sh: echo \$(jx-release-version) > VERSION
          name: next-version
          comment: so we can retrieve the version in later steps
        - sh: jx step tag --version \$(cat VERSION)
          name: tag-version
      build:
        steps:
        - sh: make build
          name: make-build